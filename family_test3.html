<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://d3js.org/d3-color.v1.min.js"></script>
	<script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
	<script src="https://d3js.org/d3-ease.v1.min.js"></script>
	<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
	<script src="https://d3js.org/d3-selection.v1.min.js"></script>
	<script src="https://d3js.org/d3-timer.v1.min.js"></script>
	<script src="https://d3js.org/d3-transition.v1.min.js"></script>
	<script src="https://d3js.org/d3-drag.v1.min.js"></script>
	<script src="https://d3js.org/d3-zoom.v1.min.js"></script>
<script type="text/javascript" src="family_data1.js"></script>
	<style>
		#family
		{
			width: 40%;
			/*max-width: 800px;*/
			height:95vh;
			/*max-height: 700px;*/
			background:#F6E5FF;
		}
		path {
    		fill: none;
    		stroke: #A763CC;
   			 stroke-width: 2px;
			}
		.shapeDiamond
		{
			fill:#A763CC;
			stroke:yellow;
			stroke-width:1.5;
			/* z-index: 1; */
			cursor:pointer;
		}
		.shapeCircle
		{
			fill:#A763CC;
			/* stroke:yel; */
			cursor:pointer;
		}
		.interim
		{
			fill: blue;
			opacity: 0.2;
		}

		.grid line
		{
		  stroke-opacity:0.1;
		}
		.grid path
		{
		    stroke-width:0;
		    /* stroke-opacity:0; */
		}
	</style>
</head>
<body>

	<div id="family"></div>
	<div id="legends"></div>

<script type="text/javascript">

	var family= d3.select("#family")
				.append("svg");
	var legend=d3.select("#legends")
				.append("svg");

	var height= document.getElementById("family").clientHeight;
	var width=document.getElementById("family").clientWidth;

var padding_x=width/100;
var padding_y=height/20;

	family.attr("height","100%")
		.attr("width", "100%")
		.attr("preserveAspectRatio", "xMidYMid")
		.attr("viewBox","0 0 "+(width)+" "+(height-padding_y/2)+"");

	legend.attr("height", 100)
			.attr("width", "100%")
			.attr("preserveAspectRatio", "xMidYMid")
			.attr("viewBox","0 0 "+(width-padding_x)+" 100");

	const treelayout=d3.tree()
		.size([ width/4*3,height-padding_y/2])
		.separation(function separation(a, b) {
        return (a.parent == b.parent ? 1:1);
    });

	var yScale=d3.scaleLinear()
								.domain([1227,1860])
								.range([0,height]);


	const root=d3.hierarchy(treeData);
	const links= treelayout(root).links();





	// var symboldiamond = d3.symbol()
  // 							.type(d3.symbolDiamond)
 	// 						.size(100);
	//
	// var pathDiamond = symboldiamond();

	function make_y_gridlines() {
	      return d3.axisLeft(yScale)
	                .ticks(10)
	      }




	// family.append("g")
	//       .attr("class", "grid")
	//       .attr("transform", "translate("+(width-padding_x)+",0)")
	//       .call(make_y_gridlines()
	//       .tickSize(-(height-padding_y*2))
	//       .tickFormat("")
	//     );






	const linkPathGenerator=d3.linkVertical()
			.y(function(d){
								return yScale(d.data.year);})
			.x(function(d){ return d.x+padding_x/2;});


	var link_hori=family.selectAll("path")
		.data(links)
		.enter()
		.append("g")
		.append("path")
		.attr("d",linkPathGenerator);




var symbolDiamondGen = d3.symbol()
	.type(d3.symbolDiamond)
	.size(60)
	// .attr("class", "shapeDiamond")
	;

var symbolCircleGen = d3.symbol()
	.type(d3.symbolCircle)
	.size(10)
	;

	var interim1=family
		.append("rect")
		.attr("y", yScale("1376"))
		.attr("x",0)
		.attr("width",(width-padding_x*2))
		.attr("height",yScale(1380)-yScale(1376))
		.attr("class", "interim");

var strlenMultiplier=10;

var map=family.append('g')
	.selectAll('path')
	.data(root.descendants())
	.enter()
	.append('path')
	.attr("transform",function(d){var cor="translate("+(d.x+padding_x/2)+","+(yScale(d.data.year))+")";
	console.log(cor);
		return cor;} )
	.attr('d', function(d)
		{
			if(d.data.value==1)
				{
				return symbolDiamondGen();}
			else
				{
					return symbolCircleGen();}
		})
	.attr("class",function(d){
		if(d.data.value==1)
			{
			return "shapeDiamond";}
		else
			{
				return "shapeCircle";}

	})
	.on("mouseover", function(d)
{
	//console.log(d.data.name);
	family.append("rect")
				.attr("id","mouseover_rect")
				.attr("x",function(){

						// var strlen=d.data.name.length;
						var x=d.x+padding_x*2;
						return x;
					}

			)
				.attr("y",yScale(d.data.year)-25)
				.attr("width",function()
			{
				var strlen=d.data.name.length;
			//	console.log(strlen);
				if(strlen>10)
				return strlen*strlenMultiplier;
				else return 11*strlenMultiplier;
			})
				.attr("height",60)
				.attr("fill","white")
				.attr("stroke-opacity",0.2)
				.attr("stroke","blue")
				.attr("rx", 3)
				.attr("ry",3);

	family.append("text")
			.attr("id","mouseover_name")
				.attr("x",d.x+padding_x*2+10)
				.attr("y",yScale(d.data.year))
				.text(d.data.name);
	family.append("text")
			.attr("id","mouseover_year")
			.attr("x",d.x+padding_x*2+10)
			.attr("y",yScale(d.data.year)+20)
			.text("Reign:"+d.data.year);

})
.on("mouseout", function(d)
{
	// console.log("end");
	family.selectAll("#mouseover_name")
			.remove();
	family.selectAll("#mouseover_year")
		.remove();
	family.selectAll("#mouseover_rect")
		.remove();
})
	;




///text down here

// family.append('g')
// 	.selectAll('text')
// 	.data(root.descendants())
// 	.enter()
// 	.append('text')
// 	.attr("x", function(d){
// 		return xScale(d.data.year);
// 	})
// 	.attr("y", function(d){
// 		return d.x;
// 	})
// 	.text(function(d){return d.data.name+"  :"+d.data.year;})
// 	.attr("font-size", "5px")
// 	.attr("transform", "translate(0,0)");






var yAxis=d3.axisRight()
					.scale(yScale);
var move_line=family.append("g")
							.append("rect")
							.attr("x",0)
							.attr("y",yScale(1500))
							.attr("width", width)
							.attr("height",2);
console.log(padding_y);
var gX=family.append("g")
						.call(yAxis)
						.attr("transform", "translate("+(width)+",500 ")
						;

symbolDiamondGen.size(50);
symbolCircleGen.size(50);

legend.append("g")
			.append("path")
			.attr("transform", "translate("+width/4+",40)")
			.attr("d", symbolDiamondGen())
			.attr("class", "shapes");
legend.append("g")
			.append("path")
			.attr("transform", "translate("+width/4*3+",40)")
			.attr("d", symbolCircleGen())
			.attr("class", "shapes");

legend.append("g")
				.append("text")
				.attr("x", width/4*3+padding_x)
				.attr("y",50)
				.text("Prince");
legend.append("g")
			.append("text")
			.attr("x", width/4+padding_x)
			.attr("y",50)
			.text("King");

</script>
</body>
</html>
